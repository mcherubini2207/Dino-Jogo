<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T-Rex Combat iPad Edition</title>
    <style>
        :root { --primary: #e74c3c; --secondary: #2ecc71; --bg: #121212; }
        body { 
            margin: 0; background: var(--bg); color: white; 
            font-family: sans-serif; overflow: hidden; 
            touch-action: none; /* Bloqueia gestos do iPad */
            user-select: none; -webkit-user-select: none;
        }
        
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; }

        .hud { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; z-index: 10; font-weight: bold; }
        .bar { width: 120px; height: 15px; background: #444; border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
        #hp-bar { width: 100%; height: 100%; background: var(--secondary); transition: 0.2s; }

        canvas { background: linear-gradient(to bottom, #1a2a6c, #b21f1f); display: block; width: 100%; height: 60vh; }

        /* Controles Estilo Joystick */
        .controls-area { 
            display: flex; justify-content: space-between; align-items: center;
            height: 40vh; padding: 0 30px; background: #1a1a1a;
        }
        .d-pad, .action-pad { display: grid; gap: 15px; }
        .d-pad { grid-template-columns: 1fr 1fr; }
        .action-pad { grid-template-columns: 1fr 1fr; }

        .btn { 
            width: 80px; height: 80px; background: rgba(255,255,255,0.15); 
            border: 3px solid rgba(255,255,255,0.4); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; 
            font-size: 30px; color: white;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active { background: rgba(255,255,255,0.4); transform: scale(1.1); }
        .btn-large { width: 100px; height: 100px; border-radius: 20px; background: rgba(52, 152, 219, 0.4); }

        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .btn-play { padding: 20px 50px; font-size: 28px; background: var(--secondary); border: none; border-radius: 50px; color: white; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="hud">
        <div>HP <div class="bar"><div id="hp-bar"></div></div></div>
        <div style="font-size: 24px;">‚≠ê <span id="score-val">0</span></div>
        <div>BAG üçñ <span id="bife-count">0</span></div>
    </div>

    <div id="menu" class="overlay">
        <h1 style="font-size: 50px; color: var(--primary);">T-REX IPAD</h1>
        <button class="btn-play" onclick="startGame()">JOGAR AGORA</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="controls-area">
        <div class="d-pad">
            <div class="btn" id="leftBtn">‚¨ÖÔ∏è</div>
            <div class="btn" id="rightBtn">‚û°Ô∏è</div>
        </div>

        <div class="action-pad">
            <div class="btn btn-large" id="jumpBtn">PULO</div>
            <div class="btn" id="mordidaBtn">ü¶∑</div>
            <div class="btn" id="rugidoBtn">üì¢</div>
            <div class="btn" style="background:rgba(46, 204, 113, 0.4)" id="healBtn">üçñ</div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight * 0.6;

    let gameRunning = false, score = 0, hp = 100, bifeInventory = 0;
    let dino = { x: 100, y: canvas.height-80, w: 60, h: 60, dx: 0, dy: 0, gravity: 0.8, jumpPower: -16, grounded: false, flash: 0 };
    let enemies = [], bullets = [], particles = [];

    // L√≥gica de Toque M√∫ltiplo
    const setupBtn = (id, startFn, endFn) => {
        const el = document.getElementById(id);
        el.addEventListener('touchstart', (e) => { e.preventDefault(); startFn(); });
        el.addEventListener('touchend', (e) => { e.preventDefault(); if(endFn) endFn(); });
        // Suporte para mouse tamb√©m
        el.addEventListener('mousedown', startFn);
        el.addEventListener('mouseup', endFn);
    };

    setupBtn('leftBtn', () => dino.dx = -7, () => dino.dx = 0);
    setupBtn('rightBtn', () => dino.dx = 7, () => dino.dx = 0);
    setupBtn('jumpBtn', () => { if(dino.grounded) { dino.dy = dino.jumpPower; dino.grounded = false; } });
    setupBtn('mordidaBtn', () => attack('mordida'));
    setupBtn('rugidoBtn', () => attack('rugido'));
    setupBtn('healBtn', () => useHeal());

    function attack(type) {
        if(!gameRunning) return;
        if(type === 'rugido') bullets.push({x: dino.x + 40, y: dino.y + 20, vx: 12, type: 'sonic'});
        enemies.forEach(en => {
            if(Math.abs(en.x - dino.x) < 120) { en.hp -= 50; en.flash = 5; }
        });
    }

    function useHeal() {
        if(bifeInventory > 0) { hp = Math.min(100, hp+40); bifeInventory--; updateUI(); }
    }

    function startGame() { document.getElementById("menu").style.display = "none"; gameRunning = true; loop(); }

    function update() {
        if(!gameRunning) return;
        dino.x += dino.dx; dino.y += dino.dy; dino.dy += dino.gravity;
        if(dino.x < 0) dino.x = 0; if(dino.x > canvas.width-60) dino.x = canvas.width-60;
        if(dino.y > canvas.height-80) { dino.y = canvas.height-80; dino.dy = 0; dino.grounded = true; }

        if(Math.random() < 0.02) enemies.push({x: canvas.width+50, y: canvas.height-80, hp: 100, flash: 0});
        if(Math.random() < 0.005) bullets.push({x: Math.random()*canvas.width, y: 0, vx: 0, vy: 4, type: 'item'});

        bullets.forEach((b, i) => {
            b.x += b.vx; b.y += b.vy;
            if(b.type === 'item' && Math.abs(b.x-dino.x)<50 && Math.abs(b.y-dino.y)<50) { bifeInventory++; bullets.splice(i,1); updateUI(); }
            if(b.type === 'fire' && Math.abs(b.x-dino.x)<40 && Math.abs(b.y-dino.y)<40) { hp -= 10; bullets.splice(i,1); updateUI(); }
        });

        enemies.forEach((en, i) => {
            en.x -= 3;
            if(Math.random() < 0.01) bullets.push({x: en.x, y: en.y+20, vx: -7, vy:0, type: 'fire'});
            if(en.hp <= 0) { enemies.splice(i, 1); score += 20; updateUI(); }
            if(en.x < -100) enemies.splice(i,1);
        });

        if(hp <= 0) location.reload();
    }

    function updateUI() {
        document.getElementById("hp-bar").style.width = hp + "%";
        document.getElementById("score-val").innerText = score;
        document.getElementById("bife-count").innerText = bifeInventory;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Ch√£o
        ctx.fillStyle = "#27ae60"; ctx.fillRect(0, canvas.height-25, canvas.width, 25);
        // Dino
        ctx.font = "60px Arial"; ctx.fillText("ü¶ñ", dino.x, dino.y + 50);
        // Inimigos
        enemies.forEach(en => { 
            if(en.flash > 0) { ctx.filter = "brightness(3)"; en.flash--; }
            ctx.fillText("üêâ", en.x, en.y + 50); ctx.filter = "none";
        });
        // Balas/Itens
        bullets.forEach(b => { 
            ctx.font = "35px Arial"; 
            ctx.fillText(b.type==='fire'?"üî•":b.type==='sonic'?"üîµ":"üçñ", b.x, b.y+30); 
        });
    }

    function loop() { update(); draw(); requestAnimationFrame(loop); }
</script>
</body>
</html>
